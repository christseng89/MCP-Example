# **BPMN Object Types

## Start Event Types

### 1. **Message Start Event（訊息啟動事件）**

📩 **範例**：

* 銀行接收到一份客戶的付款申請報文（SWIFT/ISO20022）。
* 電商系統收到顧客的下單請求。

➡️ 一旦收到訊息，流程立即啟動。

---

### 2. **Timer Start Event（定時器啟動事件）**

⏰ **範例**：

* 每天凌晨 2 點自動啟動「日終對帳」流程。
* 每週一上午 9 點自動啟動「銷售週報生成」流程。

➡️ 流程由時間條件觸發。

---

### 3. **Conditional Start Event（條件啟動事件）**

📄 **範例**：

* 當庫存數量低於 100 件時，自動啟動「補貨流程」。
* 當信用卡交易金額超過 10 萬元時，自動啟動「風控審批流程」。

➡️ 當資料或業務規則滿足條件時，流程自動開始。

---

### 4. **Signal Start Event（信號啟動事件）**

📡 **範例**：

* 當公司系統廣播一個「年度結算開始」信號後，各部門的對應流程（財務結算、人事考核、銷售清算）同時啟動。
* 當供應鏈平台發出「緊急供應中斷」信號後，自動觸發備援採購和風險控制流程。

➡️ 一個流程廣播訊號，其他流程只要訂閱該訊號就會被觸發。

---

📌 總結：

* **Message** → 由外部訊息觸發（客戶下單、API 請求）。
* **Timer** → 由時間觸發（定時任務）。
* **Conditional** → 由條件觸發（庫存不足、金額超標）。
* **Signal** → 由廣播事件觸發（全局通知，多個流程響應）。

---

## Task Types

### 1. **User Task（使用者任務 w IT）**

👤 **例子**：

* 銀行業務員審批一筆信用證申請。
* 客戶經由前端系統輸入付款資料。

➡️ **需要人工操作（通常透過系統介面完成）**。

---

### 2. **Service Task（服務任務）**

⚙️ **例子**：

* 系統自動調用 API 查詢黑名單資料庫。
* ERP 系統自動更新存貨狀態。

➡️ **系統自動執行，不需人工介入**。

---

### 3. **Send Task（發送任務）**

✉️ **例子**：

* 系統自動寄送「付款確認通知」Email 給客戶。
* 核心銀行系統發送 SWIFT 訊息到對手銀行。

➡️ **主動發送訊息給外部對象**。

---

### 4. **Receive Task（接收任務）**

📩 **例子**：

* 等待供應商回覆「發票文件」。
* 等待客戶上傳 KYC 文件。

➡️ **流程需等到訊息到達後才繼續**。

* NOTES: send and receive tasks can only be used via **different pools or participants**.

---

### 5. **Manual Task（手工任務 w/o IT）**

✋ **例子**：

* 倉庫人員實際清點貨物。
* 快遞員到客戶處收件。

➡️ **非系統輔助，純人工完成**。

---

### 6. **Business Rule Task（業務規則任務）** (v)

📊 **例子**：

* 系統根據風險規則決定交易是否需要額外審批。
* 採購流程自動判斷：金額超過 100 萬 → 需要主管審批。

➡️ **透過規則引擎 (例如 *DMN* - Decision Making and Notation) 自動判斷**。

---

### 7. **Script Task（腳本任務）** (v)

📜 **例子**：

* 系統執行一段 SQL 腳本產生報表。
* 用 Python 腳本進行資料清洗。

➡️ **嵌入簡單腳本由引擎執行**。

---

### 8. **Call Activity（呼叫活動）**

🔁 **例子**：

* 在「處理信用證」流程中，呼叫一個標準子流程「KYC 驗證流程」。
* 在「供應鏈採購」流程中，重用「付款流程」。

➡️ **重複利用子流程或外部流程**。

## 9️⃣ Sub-process（Collapsed / Expanded）

* **Collapsed（折叠子流程）**：只显示一个任务框，内部细节隐藏。
* **Expanded（展开子流程）**：显示里面的所有任务和逻辑。

📌 **例子**：

* 银行：

  * **折叠** → “风险评估子流程”
  * **展开** → 内含 “信用评分检查 + 黑名单查询 + 大额交易审核”
* 电商：

  * **折叠** → “订单处理子流程”
  * **展开** → 内含 “校验库存 + 生成订单 + 通知仓库”

---

📌 總結：

* **User/Manual** → 有人工操作。
* **Service/Script/Business Rule** → 系統自動執行。
* **Send/Receive** → 與外部訊息交互。
* **Call Activity** → 重用既有子流程。
* **Sub-process** → 流程分解

---

## **BPMN** 裡，**Call Activity** 和 **Subprocess** 用途與語義不同

---

### 1. Subprocess（子流程）

* **定義**：子流程是嵌套在主流程裡的一部分，屬於 **該流程的一個組成單元**。
* **特徵**：

  * 在圖形上通常是 **圓角矩形 + 展開或折疊符號**。
  * 它 **屬於當前流程的一部分**，不能單獨重用。
* **適用場景**：

  * 在「處理訂單」主流程中，有一段邏輯比較複雜，例如「驗證付款」，可以拉出來做成一個 Subprocess，保持主流程乾淨。

---

### 2. Call Activity（呼叫活動）

* **定義**：Call Activity 會呼叫一個 **獨立定義的流程（或全局任務）**，類似程式中的「函數呼叫」。
* **特徵**：

  * 在圖形上是 **粗邊框的矩形**。
  * 它呼叫的是 **流程庫裡已經定義好的另一個流程**，可以在多個流程間重用。
* **適用場景**：

  * 銀行的所有業務流程（信用證、貸款、貿易融資）中，都可能要做 **KYC 驗證**。這時候把 KYC 驗證定義成一個獨立流程，透過 Call Activity 在不同主流程中呼叫。

---

### 3. 對比表

| 特性          | Subprocess（子流程）  | Call Activity（呼叫活動） |
| ----------- | ---------------- | ------------------- |
| **是否屬於主流程** | 是，嵌套在主流程內部       | 否，呼叫一個獨立定義的流程       |
| **可否重用**    | 不可重用（僅限於此流程）     | 可重用（不同流程都能呼叫同一個流程）  |
| **圖形表現**    | 圓角矩形（裡面可展開細節）    | 粗邊框矩形（呼叫外部流程）       |
| **使用場景**    | 主流程內邏輯複雜但只服務於此流程 | 標準流程或任務會被多個流程反覆呼叫   |

---

👉 簡單記法：

* **Subprocess = 內部封裝**（流程的一部分）。
* **Call Activity = 外部引用**（呼叫獨立流程，可重用）。

---

## 📌 中间事件分类与实例 (Catch and Throw)

### 1. Message Intermediate Catch Event（消息中间捕获事件）

👉 等待接收一条外部消息。
📌 **例子**：

* 银行流程 → 等待客户上传身份证复印件。
* 电商 → 等待供应商发来的“发货确认”。

---

### 2. Message Intermediate Throw Event（消息中间抛出事件）

👉 向外部发送一条消息。
📌 **例子**：

* 银行 → 系统发送短信给客户：“您的贷款申请已收到”。
* 电商 → 系统发送邮件给客户：“订单已发货”。

---

### 3. Timer Intermediate Catch Event（定时器中间捕获事件）

👉 等待到某个时间点或超时后触发。
📌 **例子**：

* 银行 → 等待 24 小时，如果客户没补交资料则关闭申请。
* 电商 → 如果 7 天内客户未确认收货，系统自动完成订单。

---

### 4. Escalation Intermediate Throw Event（升级中间抛出事件）

👉 把问题升级给更高级别处理。
📌 **例子**：

* 客服无法解决客户投诉 → 抛出升级事件 → 交由经理处理。

---

### 5. Conditional Intermediate Catch Event（条件中间捕获事件）

👉 当某个业务条件满足时触发。
📌 **例子**：

* 银行 → 当账户余额 < 100 元时，触发提醒客户充值。
* 电商 → 当库存 = 0 时，触发“缺货”流程。

---

### 6. Link Intermediate Catch / Throw Event（链接中间事件）

👉 用来连接流程图不同部分，像“跳转锚点”。
📌 **例子**：

* 在一张大流程图里，用 Link 把“下单部分”跳转到“发货部分”，避免画太多箭头。

---

### 7. Compensation Intermediate Throw Event（补偿中间抛出事件）

👉 触发补偿动作，通常在事务失败时执行。
📌 **例子**：

* 银行 → 转账失败 → 触发“退回手续费”补偿动作。
* 电商 → 订单取消 → 触发“退回优惠券”。

---

### 8. Signal Intermediate Catch / Throw Event（信号中间事件）

👉 **广播事件**，一个抛出事件可以被多个捕获事件接收。
📌 **例子**：

* 银行 → 信号“系统停机维护” → 所有分支流程捕获并暂停。
* 电商 → 信号“促销开始” → 多个子流程（推送通知、更新首页 Banner、调整价格）同时触发。

---

✅ **总结**

* **Message** → 点对点消息（收/发）
* **Timer** → 时间条件
* **Escalation** → 问题升级
* **Conditional** → 业务条件触发
* **Link** → 流程跳转
* **Compensation** → 事务补偿
* **Signal** → 广播事件

---

## ✅ **BPMN End Event** 幾種類型的例子**

---

### 0. **Plain End Event（普通結束事件）**

🔚 **例子**
：

### 1. **Message End Event（訊息結束事件）**

📩 **例子**：
銀行處理完客戶的信用證申請後，系統自動發送一封「申請完成通知」給客戶。
👉 流程結束時，伴隨著一個 **訊息發送**。

---

### 2. **Escalation End Event（升級結束事件）**

⚠️ **例子**：
審批過程中，如果金額超過 1,000 萬美元，則自動 **升級**，將案件提交到更高層級主管處理。
👉 流程結束，但會觸發一個 **升級事件**給上級流程。

---

### 3. **Error End Event（錯誤結束事件）**

❌ **例子**：
付款交易中，如果發現資金不足，流程以 **錯誤事件**結束，並返回「資金不足」錯誤給核心系統。
👉 流程異常結束，通常會進入 **錯誤處理邏輯**。

---

### 4. **Compensation End Event（補償結束事件）**

↩️ **例子**：
在旅遊預訂系統中，如果付款成功但機票訂位失敗，流程以補償事件結束，觸發 **退款動作**。
👉 流程結束並要求 **補償動作（撤銷、退款、回滾）**。

---

### 5. **Signal End Event（信號結束事件）**

📡 **例子**：
在供應鏈流程中，倉庫庫存不足時，流程以 **信號事件**結束，廣播「庫存不足」給所有相關流程（採購、物流、客服）。
👉 發出全局信號，讓其他流程能同步響應。

---

### 6. **Terminate End Event（終止結束事件）**

⏹️ **例子**：
在貸款申請流程中，如果客戶被判定為高風險，流程直接 **終止**，所有正在進行的子流程（如 KYC、徵信查詢）都被強制停止。
👉 **強制終止**整個流程，立即結束。

---

✅ **總結**：

* **Message** → 發送通知
* **Escalation** → 向上升級
* **Error** → 錯誤結束
* **Compensation** → 觸發補償動作
* **Signal** → 廣播事件
* **Terminate** → 強制終止全部流程

---

## Pool and Lane 表示 **參與者** 與 **角色分工** 的視覺化元素。

---

## 📌 1. Pool（池）

* **定義**：代表**一個**「參與者」或「**組織**/系統」在流程中的邊界。
* **特徵**：不同的 Pool 之間只能透過 **Message Flow（訊息流）** 溝通，不能直接用 Sequence Flow（順序流）。
* **現實例子**：

  * **銀行 vs 客戶**：在信用證流程中，一個 Pool 是「銀行」，另一個 Pool 是「客戶」。
  * **公司 vs 供應商**：採購流程中，公司在一個 Pool，供應商在另一個 Pool，兩邊靠訂單、發票等訊息互動。

---

## 📌 2. Lane（泳道）

* **定義**：Pool 內的細分，用來表示**不同部門**、角色或系統。
* **特徵**：泳道之間仍然用 **Sequence Flow**，因為它們屬於同一個參與者的內部分工。
* **現實例子**：

  * 在「銀行 Pool」裡，可以劃分泳道：

    * **前台業務員**：接收客戶申請。
    * **合規部門**：做 KYC/AML 檢查。
    * **後台操作人員**：落單並發送 SWIFT 訊息。
  * 在「公司 Pool」裡：

    * **採購部門** → 建立採購請求。
    * **財務部門** → 審批付款。
    * **倉儲部門** → 驗收貨物。

---

## ✅ 中文總結

* **Pool = 大的參與者 / 組織 / 系統**（例如：銀行、客戶、供應商）。
* **Lane = Pool 裡的角色 / 部門 / 職能分工**（例如：銀行內的業務員、合規、財務）。

---

## BPMN 网关类型及示例

### 1. 排他网关（Exclusive Gateway, XOR）

* **含义**：在多个分支中 **只能选择一条**，条件互斥。
* **图标**：菱形，中间是“X”。
* **真实案例**：
  网上书店下单 → 判断 **库存是否充足**：

  * 是 → 进入“打包发货”流程
  * 否 → 进入“通知客户缺货”流程

---

### 2. 并行网关（Parallel Gateway, AND）

* **含义**：**同时执行多个分支**，所有分支必须完成才能汇聚。
* **图标**：菱形，中间是“+”。
* **真实案例**：
  新员工入职流程：

  * 同时触发 **人事准备工牌**、**IT 配置电脑账户**、**行政安排工位**。
  * 三个任务全部完成后 → 才能进入“新员工正式入职”环节。

---

### 3. 包容网关（Inclusive Gateway, OR）

* **含义**：在多个分支中，**可选择一条或多条**，按条件决定。
* **图标**：菱形，中间是一个圆圈。
* **真实案例**：
  银行贷款审批流程：

  * 如果贷款金额大 → 同时需要 **风险部门审核** + **财务部门审核**。
  * 如果金额小 → 只需要 **客户经理审核**。
  * 有时可能需要多个分支一起走，有时只走一个。

---

### 4. 复杂网关（Complex Gateway）

* **含义**：处理复杂的组合条件或自定义逻辑。
* **图标**：菱形，中间是“\*”。
* **真实案例**：
  跨国公司审批：

  * 要么 **2 位高管批准**，要么 **1 位总经理批准**，才可继续流程。
  * 这种逻辑无法用简单的 XOR/AND/OR 表达，就需要复杂网关。

---

### 5. 事件型网关（Event-based Gateway）

* **含义**：流程分支不是由条件判断决定，而是 **等待某个事件发生** 来决定走哪条路。
* **图标**：菱形，外面有两个小圆圈。
* **真实案例**：
  客户支付流程：

  * 系统等待事件：

    * **事件A**：客户在 3 天内付款 → 进入“发货”流程
    * **事件B**：3 天内未付款（定时器事件触发） → 进入“取消订单”流程
  * 谁先发生，流程就走哪一条。

---

### ✅ 总结

* **排他（XOR）**：只能走一条（例如“有库存 / 无库存”）。
* **并行（AND）**：同时执行多条（例如“入职三项任务”）。
* **包容（OR）**：一条或多条（例如“贷款审批可多路同时进行”）。
* **复杂（Complex）**：自定义的高级逻辑（例如“2 个经理或 1 个总经理”）。
* **事件型（Event-based）**：等待外部事件决定路径（例如“付款 / 超时未付款”）。

---

## **Data Object（数据对象）** 表示流程中需要读/写的业务数据

### 📦 实际案例：银行贷款审批流程

**场景说明**
客户提交贷款申请表，银行审批人员需要审核资料 → 审核通过后进入合同签署 → 放款。 **BPMN 流程（文字版）**

1. **开始事件**：客户提交贷款申请

   * Data Object: 《贷款申请表》
2. **任务：初审**（由客服人员执行）

   * 读取《贷款申请表》
   * 输出 Data Object: 《初审意见》
3. **任务：风险评估**（由风险部门执行）

   * 输入 Data Object: 《贷款申请表》《初审意见》
   * 输出 Data Object: 《风险评估报告》
4. **网关：是否通过？**

   * 否 → 结束事件（拒绝，输出 Data Object: 《拒绝通知》）
   * 是 → 下一步
5. **任务：合同生成**（由系统执行）

   * 输入 Data Object: 《贷款申请表》《风险评估报告》
   * 输出 Data Object: 《贷款合同》
6. **任务：放款**

   * 输入 Data Object: 《贷款合同》
   * 输出 Data Object: 《放款凭证》
7. **结束事件**：流程完成

### 📝 重点说明

* **贷款申请表** 是起始输入数据对象，整个流程都依赖它。
* **风险评估报告** 是审批部门生成的中间数据对象。
* **贷款合同** 和 **放款凭证** 是最终输出。

👉 这样，BPMN 图里会在每个任务旁边画一个“纸张”形状的 Data Object，并通过 **数据关联(Data Association)** 的虚线箭头连接任务，清晰展示数据的流转。

---

### Data Store（数据存储）用来表示跨流程/长周期保存的数据

*Data Object 多为“本次流程读写的业务资料”（例如《风险评估报告》），结束后可选不永久保存；
*Data Store 是持久化载体（例如“核心银行账户系统”或“贷款档案库”），不同流程/实例都可能访问它。
*在图上通常以圆角立体盒显示，透过 **Data Association（数据关联）**虚线和任务连接，标注“读/写”关系。

## Artifact => Text Annotation（文字批注）和 Group（分组）

---

### 1️⃣ Text Annotation（文字批注）like Comments

**定义**：
文字批注是 BPMN 图里一个 **说明性元素**，用来补充说明某个活动、事件、网关或数据的业务含义。

* 它不会影响流程逻辑，只是**备注**。
* 图上是一个矩形（带折角）+ 虚线连接到目标元素。

*真实案例（银行反洗钱监控）

* 任务：`检查大额交易`
* Text Annotation：

  * **“根据监管要求，单笔 ≥ 10 万元需触发人工复核”**
  
* 用途：让读流程的人知道为什么有这个步骤，但不改变执行顺序。

*另一个例子（电商流程

* 任务：`计算运费`
* Text Annotation：

  * **“海外仓订单需加收跨境费”**

---

### 2️⃣ Group（分组）

**定义**：
Group 是一个 **虚线框**，可以把一组相关的任务或事件“圈”在一起，表示它们**属于同一逻辑分类或目的**。

* 它不影响顺序流，也不改变执行方式。
* 常用于：强调合规检查、风控步骤、某个部门的任务集合。

*真实案例（贷款审批流程）

* Group 名称：**“风险控制步骤”**
* 内含任务：

  * `初审`
  * `风险评估`
  * `反洗钱检查`
* 含义：让读者一眼看出这些任务都与风险管控相关。

*另一个例子（医院就诊流程）

* Group 名称：**“诊断阶段”**
* 内含任务：

  * `挂号`
  * `初步问诊`
  * `实验室检查`
* 含义：这些步骤都属于诊断环节，后续才进入“治疗环节”。

---

## 📌 总结

* **Text Annotation →** 业务说明备注（就像 PPT 上的批注）
* **Group →** 分类/分组，不改变执行逻辑，但强调主题或领域

---
